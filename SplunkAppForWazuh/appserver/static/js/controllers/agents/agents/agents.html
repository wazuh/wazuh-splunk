<!-- End loading ring -->
<div flex ng-if="!loading" class="md-padding" layout="column" layout-align="start space-around">

  <div layout="row" layout-align="space-between stretch" ng-if="!wazuhNotReadyYet">

    <div class="md-padding euiFlexGroup--wrap layout-row wz-margin-top--20">
      <div class="layout-column md-padding">
        <span class="wz-headline-title">
          <wz-svg icon="hex"></wz-svg> Status
        </span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div class="wz-margin-top-10">
          <canvas id="bar" ng-if="lastAgent && lastAgent.id"
            class="wz-margin-top-16 chart chart-doughnut wz-margin-bottom-10" ng-init="loadCharts('bar')">
        </div>
        <div layout="row" class="wz-margin-top-16 layout-align-center-center" ng-if="!lastAgent || !lastAgent.id">
          There are no agents yet.
        </div>
        <div layout="row" class="wz-margin-top-16 layout-align-center-center" ng-if="!lastAgent || !lastAgent.id">
          <button class="kuiButton kuiButton--success" ng-click="openRegistrationDocs()">
            <react-component name="EuiIcon" props="{type: 'help'}" /> How to
          </button>
        </div>
      </div>
      <div flex class="layout-column md-padding">
        <span class="wz-headline-title">
          <wz-svg icon="burble"></wz-svg> Details
        </span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div
          class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive wz-margin-top-5">
          <div class="euiFlexItem euiFlexItem--flexGrowZero">

            <div class="euiStat">
              <div class="euiText euiText--small euiStat__description">
                <p>Active</p>
              </div>
              <p class="euiTitle euiTitle--small euiStat__title">{{agentsCountActive}}</p>
            </div>
          </div>
          <div class="euiFlexItem euiFlexItem--flexGrowZero">

            <div class="euiStat">
              <div class="euiText euiText--small euiStat__description">
                <p>Disconnected</p>
              </div>
              <p class="euiTitle euiTitle--small euiStat__title">{{agentsCountDisconnected}}</p>
            </div>
          </div>
          <div class="euiFlexItem euiFlexItem--flexGrowZero">

            <div class="euiStat">
              <div class="euiText euiText--small euiStat__description">
                <p>Never connected</p>
              </div>
              <p class="euiTitle euiTitle--small euiStat__title">{{agentsCountNeverConnected}}</p>
            </div>
          </div>
          <div class="euiFlexItem euiFlexItem--flexGrowZero">

            <div class="euiStat">
              <div class="euiText euiText--small euiStat__description">
                <p>Agents coverage</p>
              </div>
              <p class="euiTitle euiTitle--small euiStat__title">{{(agentsCoverity | number:2)}}%</p>
            </div>
          </div>
        </div>
        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive">
          <div class="euiFlexItem euiFlexItem--flexGrowZero">

            <div class="euiStat">
              <div class="euiText euiText--small euiStat__description">
                <p>Last registered agent</p>
              </div>
              <p ng-if="lastAgent.id !== '000'" ng-click="showAgent(lastAgent)"
                class="euiTitle euiTitle--small euiStat__title wz-text-link cursor-pointer">
                {{lastAgent.name}}</p>
              <p ng-if="!lastAgent || !lastAgent.id" class="euiTitle euiTitle--small euiStat__title">
                -</p>
            </div>
          </div>
          <div class="euiFlexItem euiFlexItem--flexGrowZero">

            <div class="euiStat">
              <div class="euiText euiText--small euiStat__description">
                <p>Most active agent</p>
              </div>
              <p ng-if="lastAgent && lastAgent.id && mostActiveAgent.id !== '000'" ng-click="showAgent(mostActiveAgent)"
                class="euiTitle euiTitle--small euiStat__title wz-text-link cursor-pointer">
                {{mostActiveAgent}}</p>
              <p ng-if="!lastAgent || !lastAgent.id" class="euiTitle euiTitle--small euiStat__title">
                -</p>
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- Search bar -->
  <div ng-if="!loading" layout="row" layout-align="space-between stretch">
    <wz-tag-filter flex path="'/agents'" query-fn="query(q, search)" fields-model="searchBarModel"></wz-tag-filter>
    <button type="submit" aria-label="Search" class="btn wz-button-empty wz-margin-left-10 wz-margin-top-15"
      ng-click="reloadList()">
      <wz-svg icon="refresh"></wz-svg>
      <span>Refresh</span>
    </button>
  </div>

  <md-card class="wz-md-card no-margin-sides wz-margin-top-15">
    <!-- Table -->
    <div ng-if="!loading" layout="row" class="wz-margin-10">
      <wazuh-table flex path="'/agents'" custom-columns="true"
        keys="['id',{value:'name',size:2},'ip','status','group','os.name','os.version','version', {value: 'dateAdd', offset: true}, {value: 'lastKeepAlive', offset: true}]"
        allow-click="true" rows-per-page="17"></wazuh-table>
    </div>
    <!-- Download CSV -->
    <div layout="row" class="ruleset-csv-formater">
      <span flex></span>
      <a class="small formatted-color" id="btnDownload" ng-click="downloadCsv()">
        <svg class="euiIcon euiIcon--medium" focusable="false" xmlns="http://www.w3.org/2000/svg" width="16" height="16"
          viewBox="0 0 16 16">
          <path
            d="M9 10.114l1.85-1.943a.52.52 0 0 1 .77 0c.214.228.214.6 0 .829l-1.95 2.05a1.552 1.552 0 0 1-2.31 0L5.41 9a.617.617 0 0 1 0-.829.52.52 0 0 1 .77 0L8 10.082V1.556C8 1.249 8.224 1 8.5 1s.5.249.5.556v8.558zM4.18 6a.993.993 0 0 0-.972.804l-1.189 6A.995.995 0 0 0 2.991 14h11.018a1 1 0 0 0 .972-1.196l-1.19-6a.993.993 0 0 0-.97-.804H4.18zM6 5v1h5V5h1.825c.946 0 1.76.673 1.946 1.608l1.19 6A2 2 0 0 1 14.016 15H2.984a1.992 1.992 0 0 1-1.945-2.392l1.19-6C2.414 5.673 3.229 5 4.174 5H6z">
          </path>
        </svg>&nbsp;Formatted
      </a>
    </div>
  </md-card>
</div>