<div flex layout="column" layout-align="start stretch">

  <!-- Breadcrumbs -->
  <div layout="row" class="wz-height-35">
    <div class='wz-breadcrumb-margin'>
      <a class="wz-text-link cursor-pointer" ui-sref='agents'>Agents</a>
      <span> / </span>
      <span ng-if="!agent.error" class="wz-text-link cursor-pointer">{{agent.name}} ({{agent.id}})</span>
      <span ng-if="agent.error">Unknown agent</span>
      <span ng-if="agent.status">
        <span class="wz-agent-status-indicator small" ng-class="getAgentStatusClass(agent.status)"
          aria-label="Agent status indicator">{{formatAgentStatus(agent.status)}}</span>
      </span>
    </div>
  </div>
  <!-- End breadcrumbs -->

  <!-- Headline -->
  <div layout="column" layout-padding>
    <div layout="row" class="wz-no-padding-bottom">
      <span class="font-size-20 wz-lh-32">
        <i class="fa fa-fw fa-tv" aria-hidden="true"></i> {{ agent.name || '-' }}
      </span>
      <span flex="" class="flex"></span>
      <button class="btn wz-button-empty pull-right ng-scope wz-margin-right-10" ng-click='openDiscover(agent.id)'
        tooltip="Discover">
        <wz-svg icon="compass"></wz-svg>
        Discover
      </button>
      <!-- Restart button -->
      <div ng-show="confirmingRestart" style="text-align: right;">
        <span style="padding-top: 8px;">The {{ agent.name}}({{agent.id}}) will be restarted.</span>
        <button style="height: 30px;" ng-if="isAdmin" ng-click="switchRestart()"
          class='btn wz-button-cancel pull-right wz-margin-left-10'>
          <span ng-show='isAdmin'><i aria-hidden='true' class='wz-margin-left-10'></i>Cancel</span>
        </button>
        <button style="height: 30px;" ng-if="isAdmin && !clusterEnabled" ng-click="restart(); switchRestart()"
          class='btn wz-button-empty pull-right wz-margin-left-10'>
          <span ng-show='isAdmin'><i aria-hidden='true' class='fa fa-fw fa-check wz-margin-left-10'></i>Confirm</span>
        </button>
      </div>
      <div ng-show="!confirmingRestart">
        <button ng-if="isAdmin && agent.status === 'Active'" ng-click="switchRestart()" ng-disabled="restartInProgress"
          class="btn wz-button-empty pull-right ng-scope">
          <span aria-hidden="false">
            <wz-svg icon="refresh"></wz-svg>
            Restart agent
          </span>
        </button>
      </div>
    </div>
    <div layout="row" layout-padding class="wz-no-padding wz-margin-top-20">
      <md-card flex class="wz-md-card wz-padding-top-0 wz-padding-bottom-0">
        <md-card-content class="agent-details-box">
          <div
            class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--directionRow euiFlexGroup--responsive">
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">ID</p>
                </div>
                <p class="euiText--small euiStat__description">{{ agent.id || '-' }}</p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">IP</p>
                </div>
                <p class="euiText--small euiStat__description">{{ agent.ip || '-'}}</p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">Version</p>
                </div>
                <p class="euiText--small euiStat__description">{{ agent.version || '-'}}</p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">OS</p>
                </div>
                <p class="euiText--small euiStat__description">{{ agentOS || '-'}}</p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">Registration date</p>
                </div>
                <p class="euiText--small euiStat__description">{{offsetTimestamp('', agent.dateAdd) || '-'}}</p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">Last keep alive</p>
                </div>
                <p class="euiText--small euiStat__description">{{offsetTimestamp('', agent.lastKeepAlive) || '-'}}</p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">Last syscheck scan</p>
                </div>
                <p class="euiText--small euiStat__description" ng-if="syscheck.inProgress">Scan
                  in progress</p>
                <p class="euiText--small euiStat__description" ng-if="!syscheck.inProgress">
                  {{offsetTimestamp('', syscheck.end) || '-'}}
                  <md-tooltip ng-if="!syscheck.inProgress && syscheck.start && syscheck.end"
                    md-direction="bottom" class="wz-tooltip">
                    Start time: {{offsetTimestamp('', syscheck.start) || '-'}} <br>
                    End time: {{offsetTimestamp('', syscheck.end) || '-'}} <br>
                    Duration time: {{syscheck.duration +' minutes' || '-'}}
                  </md-tooltip>
                </p>
              </div>
            </div>
            <div class="euiFlexItem euiFlexItem">
              <div class="euiStat euiStat--leftAligned">
                <div class="euiText euiText--small euiStat__description">
                  <p class="agentField">Last rootcheck scan</p>
                </div>
                <p class="euiText--small euiStat__description" ng-if="rootcheck.inProgress">Scan
                  in progress</p>
                <p class="euiText--small euiStat__description" ng-if="!rootcheck.inProgress">{{offsetTimestamp('', rootcheck.end)
                              || '-'}}
                  <md-tooltip ng-if="!rootcheck.inProgress && rootcheck.start && rootcheck.end"
                    md-direction="bottom" class="wz-tooltip">
                    Start time: {{offsetTimestamp('', rootcheck.start) || '-'}} <br>
                    End time: {{offsetTimestamp('', rootcheck.end) || '-'}} <br>
                    Duration time: {{rootcheck.duration + ' minutes' || '-'}}
                  </md-tooltip>
                </p>
              </div>
            </div>
          </div>
        </md-card-content>
      </md-card>
    </div>
  </div>
  <!-- End headline -->

  <div layout="row" layout-padding class="wz-margin-top--15">
    <md-card flex class="wz-md-card wz-padding-top-0 wz-padding-bottom-0">
      <md-card-content>

        <div layout="row" ng-if="agent.group">
          <span class="font-size-17">Groups
            <wz-svg ng-if='adminMode' ng-click="switchGroupEdit()" svg-tooltip="Add group" icon="plus" color="#0079a5">
            </wz-svg>
          </span>
        </div>
        <md-divider ng-if="agent.group" class="wz-margin-top-10"></md-divider>
        <div layout="row" class="wz-margin-top-10" ng-if="agent.group && editGroup && !addingGroupToAgent">
          <div class="wz-word-break" flex ng-if="groups && groups.length">
            Available groups:
          </div>
          <div class="wz-word-break" flex ng-if="!groups || !groups.length">
            No more groups available. Create a new group at <span><a ui-sref="mg-groups">Management > Groups</a>.</span>
          </div>
        </div>
        <div ng-if="agent.group && editGroup && !addingGroupToAgent && groups && groups.length" class="wz-margin-top-4">
          <span ng-repeat="group in groups" class="wz-text-bold wz-text-link" ng-click="showConfirmAddGroup(group)">{{
                  group }}&nbsp;</span>
        </div>

        <div class="wz-margin-top-10 confirmEmbedBubble" ng-if="agent.group && editGroup && addingGroupToAgent">
          <div layout="row">
            <span class="font-size-12  wz-padding-left-8"> Agent {{agent.name}}({{agent.id}}) will be added to group
              {{addingGroupToAgent}}.</span>
          </div>
          <div layout="row">
            <md-button class="cancelBtn" type="button" ng-click="cancelAddGroup()">Cancel</md-button>
            <md-button class="agreeBtn" type="button" ng-click="confirmAddGroup(addingGroupToAgent)"><i
                aria-hidden='true' class='fa fa-fw fa-check'></i> Confirm</md-button>
          </div>
        </div>
        <div layout="row" ng-if="agent.group" class="wz-word-break wz-padding-top-10">
          <span ng-repeat="group in agent.group" class="wz-text-bold wz-text-link font-size-15"
            ng-click="goGroups(group)">{{
                  group
                  }}&nbsp;</span>
        </div>

      </md-card-content>
    </md-card>
  </div>

  <div layout="column" ng-if="agent.error">
    <!-- No configuration card -->
    <md-card class="wz-md-card">
      <md-card-content class="wz-text-center">
        <i class="fa fa-fw fa-info-circle" aria-hidden="true"></i> <span class="wz-headline-title">Unable to load agent
          data</span>
        <md-divider class="wz-margin-top-10"></md-divider>
        <div layout="column" class="wz-padding-top-10">
          <p>{{agent.error}}</p>
        </div>
      </md-card-content>
    </md-card>
  </div>

  <div layout="row" layout-padding ng-if="!agent.error">
    <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">
      <div class="euiFlexItem flex-50">
        <div class="euiPanel euiPanel--paddingLarge">
          <h3 class="euiTitle wc-title">Security Information Management<span style="float:right;"><wz-svg icon="eye"></wz-svg></span></h3>
          <div class="euiSpacer euiSpacer--m"></div>
          <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--halves">
            <wz-welcome-card class="euiFlexItem" logo="'/static/app/SplunkAppForWazuh/css/images/app_dashboard.svg'"
              sub-title="'Security events'" ui-sref='ag-general({id:agent.id})' current-tab="'general'"
              description="'Browse through your security alerts, identifying issues and threats in your environment.'">
            </wz-welcome-card>
            <wz-welcome-card class="euiFlexItem" logo="'/static/app/SplunkAppForWazuh/css/images/app_logging.svg'"
              sub-title="'Integrity monitoring'" ui-sref='ag-fim({id:agent.id})' current-tab="'fim'"
              description="'Alerts related to file changes, including permissions, content, ownership and attributes.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if="!agent.error" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_devtools.svg'" sub-title="'Configuration'"
              ui-sref='ag-conf({id:agent.id})' current-tab="'configuration'"
              description="'Check the current agent configuration remotely applied by its group.'"></wz-welcome-card>
            <wz-welcome-card ng-if="!agent.error" ui-sref='ag-inventory({id:agent.id})' class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_index_pattern.svg'" sub-title="'Inventory data'"
              switch-tab="switchTab('syscollector')" current-tab="'syscollector'"
              description="'Applications, network configuration, open ports and processes running on your monitored systems.'">
            </wz-welcome-card>
          </div>
        </div>
      </div>
      <div class="euiFlexItem flex-50">
        <div class="euiPanel euiPanel--paddingLarge">
          <h3 class="euiTitle wc-title">Auditing and Policy Monitoring<span style="float:right;"><wz-svg icon="eye"></wz-svg></span></h3>
          <div class="euiSpacer euiSpacer--m"></div>
          <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--halves">
            <wz-welcome-card class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_advanced_settings.svg'"
              sub-title="'Policy monitoring'" ui-sref='ag-pm({id:aoc.agent.id})' current-tab="'pm'"
              description="'Configuration to ensure compliance with security policies, standards and hardening guides'">
            </wz-welcome-card>
            <wz-welcome-card class="euiFlexItem" logo="'/static/app/SplunkAppForWazuh/css/images/sca.png'"
              sub-title="'Security Configuration Assessment'" ui-sref='ag-ca({id:aoc.agent.id})'
              current-tab="'conf-assess'" description="'Scan your assets as part of a configuration assessment audit.'">
            </wz-welcome-card>
            <wz-welcome-card class="euiFlexItem" logo="'/static/app/SplunkAppForWazuh/css/images/app_monitoring.svg'"
              sub-title="'System auditing'" ui-sref='ag-audit({id:agent.id})' ng-if="audit && checkModules('audit')"
              current-tab="'audit'"
              description="'Audit users behavior, monitoring command execution and alerting on access to critical files.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if="oscap && checkModules('oscap')" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_discover.svg'" sub-title="'Open SCAP'"
              ui-sref='ag-os({id:agent.id})' current-tab="'oscap'"
              description="'Configuration assessment and automation of compliance monitoring using SCAP checks.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if='ciscat' ui-sref='ag-ciscat({id:agent.id})' class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_advanced_settings.svg'" sub-title="'CIS-CAT'"
              switch-tab="switchTab('ciscat')" current-tab="'ciscat'"
              description="'Configuration assessment using Center of Internet Security scanner and SCAP checks.'">
            </wz-welcome-card>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div layout="row" layout-padding ng-if="!agent.error">
    <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">
      <div class="euiFlexItem flex-50">
        <div class="euiPanel euiPanel--paddingLarge">
          <h3 class="euiTitle wc-title">Threat Detection and Response<span style="float:right;"><wz-svg icon="eye"></wz-svg></span></h3>
          <div class="euiSpacer euiSpacer--m"></div>
          <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--halves">
            <wz-welcome-card ng-if="checkModules('vuls')" class="euiFlexItem" logo="'/static/app/SplunkAppForWazuh/css/images/app_security.svg'"
              sub-title="'Vulnerabilities'" ui-sref='ag-vul({id:agent.id})' current-tab="'vuls'"
              description="'Discover what applications are affected by well-known vulnerabilities'"></wz-welcome-card>
            <wz-welcome-card ng-if="virustotal" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_saved_objects.svg'" sub-title="'VirusTotal'"
              ui-sref='ag-virustotal' current-tab="'virustotal'"
              description="'Alerts resulting from VirusTotal analysis of suspicious files via an integration with their API.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if="osquery" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/osquery.svg'" sub-title="'Osquery'" ui-sref='ag-osquery'
              current-tab="'osquery'"
              description="'Osquery allows to expose an operating system as a high-performance relational database.'">
          </wz-welcome-card>
          <wz-welcome-card ng-if="docker && checkModules('docker')" class="euiFlexItem" logo="'/static/app/SplunkAppForWazuh/css/images/docker.png'" 
            sub-title="'Docker listener'" ui-sref='ag-docker' current-tab="'docker'" 
            description="'Collects events on Docker containers such as starting, stopping or pausing.'">
          </wz-welcome-card>
            <div ng-if="(agentPlatform !== 'linux') && !docker && !osquery && !virustotal" flex class="euiCallOut euiCallOut--success">
              <div class="euiCallOutHeader">
                <svg class="euiIcon euiIcon--medium euiCallOutHeader__icon" aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"
                  viewBox="0 0 16 16">
                  <defs>
                    <path id="help-a"
                      d="M13.6 12.186l-1.357-1.358c-.025-.025-.058-.034-.084-.056.53-.794.84-1.746.84-2.773a4.977 4.977 0 0 0-.84-2.772c.026-.02.059-.03.084-.056L13.6 3.813a6.96 6.96 0 0 1 0 8.373zM8 15A6.956 6.956 0 0 1 3.814 13.6l1.358-1.358c.025-.025.034-.057.055-.084C6.02 12.688 6.974 13 8 13a4.978 4.978 0 0 0 2.773-.84c.02.026.03.058.056.083l1.357 1.358A6.956 6.956 0 0 1 8 15zm-5.601-2.813a6.963 6.963 0 0 1 0-8.373l1.359 1.358c.024.025.057.035.084.056A4.97 4.97 0 0 0 3 8c0 1.027.31 1.98.842 2.773-.027.022-.06.031-.084.056l-1.36 1.358zm5.6-.187A4 4 0 1 1 8 4a4 4 0 0 1 0 8zM8 1c1.573 0 3.019.525 4.187 1.4l-1.357 1.358c-.025.025-.035.057-.056.084A4.979 4.979 0 0 0 8 3a4.979 4.979 0 0 0-2.773.842c-.021-.027-.03-.059-.055-.084L3.814 2.4A6.957 6.957 0 0 1 8 1zm0-1a8.001 8.001 0 1 0 .003 16.002A8.001 8.001 0 0 0 8 0z">
                    </path>
                  </defs>
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#help-a" fill-rule="evenodd"></use>
                </svg>
                <span class="euiCallOutHeader__title">Click the <wz-svg icon="eye"></wz-svg> icon to show Threat detection and response extensions. </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="euiFlexItem flex-50">
        <div class="euiPanel euiPanel--paddingLarge">
          <h3 class="euiTitle wc-title">Regulatory Compliance<span style="float:right;"><wz-svg icon="eye"></wz-svg></span></h3>
          <div class="euiSpacer euiSpacer--m"></div>
          <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--halves">
            <wz-welcome-card ng-if="pci" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_apm.svg'" sub-title="'PCI DSS'"
              ui-sref='ag-pci({id:agent.id})' current-tab="'pci'"
              description="'Global security standard for entities that process, store or transmit payment cardholder data.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if="gdpr" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_visualize.svg'" sub-title="'GDPR'"
              ui-sref='ag-gdpr({id:agent.id})' current-tab="'gdpr'"
              description="'General Data Protection Regulation (GDPR) sets guidelines for processing of personal data.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if="hipaa" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_visualize.svg'" sub-title="'HIPAA'"
              ui-sref='ag-hipaa({id:agent.id})' current-tab="'gdpr'"
              description="'Health Insurance Portability and Accountability Act of 1996 (HIPAA) provides data privacy and security provisions for safeguarding medical information.'">
            </wz-welcome-card>
            <wz-welcome-card ng-if="nist" class="euiFlexItem"
              logo="'/static/app/SplunkAppForWazuh/css/images/app_visualize.svg'" sub-title="'NIST 800-53'"
              ui-sref='ag-nist({id:agent.id})' current-tab="'gdpr'"
              description="'National Institute of Standards and Technology Special Publication 800-53 (NIST 800-53) sets guidelines for federal information systems.'">
            </wz-welcome-card>
            <div ng-if="!gdpr && !pci && !hipaa && !nist" flex class="euiCallOut euiCallOut--success">
              <div class="euiCallOutHeader">
                <svg class="euiIcon euiIcon--medium euiCallOutHeader__icon" aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="16" height="16"
                  viewBox="0 0 16 16">
                  <defs>
                    <path id="help-a"
                      d="M13.6 12.186l-1.357-1.358c-.025-.025-.058-.034-.084-.056.53-.794.84-1.746.84-2.773a4.977 4.977 0 0 0-.84-2.772c.026-.02.059-.03.084-.056L13.6 3.813a6.96 6.96 0 0 1 0 8.373zM8 15A6.956 6.956 0 0 1 3.814 13.6l1.358-1.358c.025-.025.034-.057.055-.084C6.02 12.688 6.974 13 8 13a4.978 4.978 0 0 0 2.773-.84c.02.026.03.058.056.083l1.357 1.358A6.956 6.956 0 0 1 8 15zm-5.601-2.813a6.963 6.963 0 0 1 0-8.373l1.359 1.358c.024.025.057.035.084.056A4.97 4.97 0 0 0 3 8c0 1.027.31 1.98.842 2.773-.027.022-.06.031-.084.056l-1.36 1.358zm5.6-.187A4 4 0 1 1 8 4a4 4 0 0 1 0 8zM8 1c1.573 0 3.019.525 4.187 1.4l-1.357 1.358c-.025.025-.035.057-.056.084A4.979 4.979 0 0 0 8 3a4.979 4.979 0 0 0-2.773.842c-.021-.027-.03-.059-.055-.084L3.814 2.4A6.957 6.957 0 0 1 8 1zm0-1a8.001 8.001 0 1 0 .003 16.002A8.001 8.001 0 0 0 8 0z">
                    </path>
                  </defs>
                  <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#help-a" fill-rule="evenodd"></use>
                </svg>
                <span class="euiCallOutHeader__title">Click the <wz-svg icon="eye"></wz-svg> icon to show regulatory compliance extensions. </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>